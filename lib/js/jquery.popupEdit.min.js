(function(a){a.widget("dsabs.popupEdit",a.dsabs.basePopup,{options:{popup:null,submitText:"Submit",ajax:{success:function(){},error:function(){}},dialog:{modal:true,autoOpen:true,width:450},templates:{errorPopup:a('<div id="errorPopup" class="errorPopup"></div>')}},_create:function(){if(this.options.popup===null){console.error("Missing option: popup");return false}this._super();this._config.dialog={open:this.options.dialog.open,close:this.options.dialog.close};this._addListener()},_addListener:function(){this.element.on("click.pe touch.pe",a.proxy(function(b){b.preventDefault();this._createPopup()},this))},_createPopup:function(){if(typeof a(this.options.popup).dialog("instance")!=="undefined"){return}a(this.options.popup).dialog(a.extend(true,this.options.dialog,{create:a.proxy(this._openCallback,this),close:a.proxy(this._closeCallback,this)}))},_openCallback:function(c){var b=a(c.target);if(this._config.dataUrl){a.ajax(this._config.dataUrl,{success:a.proxy(function(d){this._successCallback(b,d.data)},this),error:a.proxy(function(d){if(typeof d.error!=="undefined"){this._error(d.error)}else{this._error(this.window[0].translations.unkownError)}},this)})}b.find(".buttonArea").children(":submit").val(this.options.submitText);b.children("form").on("submit",a.proxy(function(f){f.preventDefault();var j={},e=a(f.target),l=e.serializeArray(),k,d,h,g;for(d=0;d<l.length;d++){k=l[d];if(k.name.indexOf("[")!==-1){h=/(.*?)\[(.*?)\]/;g=k.name.match(h);if(typeof j[g[1]]!=="object"){j[g[1]]=[]}j[g[1]][g[2]]=k.value}else{j[k.name]=k.value}}a.post(this._config.targetUrl,{data:j},function(i){document.location.reload()},"json")},this));if(typeof this._config.dialog.open==="function"){this._config.dialog.open(c)}this.adjustRowLayout()},_closeCallback:function(c){var b=a(c.target);b.find("input:not([type=submit])").val("");b.find("input[type=checkbox], input[type=radio]").each(function(){a(this).prop("checked",a(this).attr("checked")==="checked")});b.children("form").off("submit");b.dialog("destroy");if(typeof this._config.dialog.close==="function"){this._config.dialog.close(c)}},_successCallback:function(c,b){a(c).children("form").find(":input").each(function(d,e){if(b[a(e).attr("name")]){if(a(e).is("input[type=checkbox], input[type=radio]")){a(e).val(1).prop("checked",b[a(e).attr("name")])}else{a(e).val(b[a(e).attr("name")])}}});this.options.ajax.success(b)},_error:function(c){var b;if(a("#"+this.options.templates.errorPopup.attr("id")).length>0){a("#"+this.options.templates.errorPopup.attr("id")).remove()}b=this.options.templates.errorPopup.clone();b.text(c);a("body").append(b);b.dialog({title:this.window[0].translations.error,modal:true});this.options.ajax.success(c)},_destroy:function(){this.element.off("click.pe touch.pe")},adjustRowLayout:function(){a(this.options.popup).find("table:first").children("tbody").children("tr:visible").addClass(function(c,b){if(b.indexOf("buttons")!==-1){return}if(c%2===0){return"even"}else{return"odd"}})}})}(jQuery));