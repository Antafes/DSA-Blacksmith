$.widget("dsabs.techniqueSelect",{options:{data:{},addLink:null,selectName:"technique",target:"tbody",templates:{tableRow:$('<tr><td class="technique"></td><td></td></tr>'),select:$("<select></select>"),removeLink:$('<a class="removeRow" href="#">X</a>')}},_create:function(){this._config={rowCount:0,rows:[]};this._addOptions();this.options.templates.select.on("change.ts",$.proxy(function(c){var a=$(c.target),b=a.val();if(a.children("[value="+b+"]").data("noOtherAllowed")===true){if(this._config.rows.length>1){this._showNoOtherAllowedDialog(a.parentsUntil("tr").parent())}$(this.options.addLink).hide()}else{$(this.options.addLink).show()}},this));this._buildRow();$(this.options.addLink).on("click.ts",$.proxy(function(){this._addRow()},this))},_addOptions:function(){$.each(this.options.data,$.proxy(function(a,c){var b=$("<option></option>");b.attr("value",c.id);b.text(c.name);b.data("noOtherAllowed",c.noOtherAllowed);this.options.templates.select.append(b)},this))},_buildRow:function(){this.options.templates.tableRow.children(".technique").append(this.options.templates.select);this.options.templates.removeLink.on("click.ts touch.ts",$.proxy(function(c){var b=$(c.target),d=b.parent().parent(),a=d.find("select");this._config.rows.splice(this._config.rows.indexOf(d),1);if(a.children("[value="+a.val()+"]").data("noOtherAllowed")===true){$(this.options.addLink).show()}if(this._config.rows.length===0){this.element.hide()}d.remove()},this));this.options.templates.tableRow.children("td:last").append(this.options.templates.removeLink)},_addRow:function(){var a=this.options.templates.tableRow.clone(true);a.children(".technique").children("select").attr("name",this.options.selectName+"["+this._config.rowCount+"]");this.element.children(this.options.target).append(a);this._config.rows.push(a);this._config.rowCount++;this.element.show()},_showNoOtherAllowedDialog:function(a){var b=$("<div>");b.html(window.translations.noOtherAllowedInfo);b.dialog({autoOpen:true,modal:true,buttons:[{text:window.translations.ok,click:$.proxy(function(d,f){for(var c=0;c<this._config.rows.length;c++){var g=this._config.rows[c];if(g.is(a)){continue}g.remove()}this._config.rows=[a];d.dialog("close")},this,b)},{text:window.translations.cancel,click:function(){a.find("select").children(":first-child").prop("selected",true);$(this).dialog("close");$(this.options.addLink).show()}}],close:function(){$(this).dialog("destroy")}})}});